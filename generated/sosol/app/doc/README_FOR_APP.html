<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>README_FOR_APP</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body class="file">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../HgvMetaIdentifierHelper.html">HgvMetaIdentifierHelper</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvDate.html">HgvMetaIdentifierHelper::HgvDate</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvFormat.html">HgvMetaIdentifierHelper::HgvFormat</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvFuzzy.html">HgvMetaIdentifierHelper::HgvFuzzy</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvGeo.html">HgvMetaIdentifierHelper::HgvGeo</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvGeo/GeoSpot.html">HgvMetaIdentifierHelper::HgvGeo::GeoSpot</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvGeo/Place.html">HgvMetaIdentifierHelper::HgvGeo::Place</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvGeo/Provenance.html">HgvMetaIdentifierHelper::HgvGeo::Provenance</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvMentionedDate.html">HgvMetaIdentifierHelper::HgvMentionedDate</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvProvenance.html">HgvMetaIdentifierHelper::HgvProvenance</a>
  
    <li><a href="../HgvMetaIdentifierHelper/HgvPublication.html">HgvMetaIdentifierHelper::HgvPublication</a>
  
    <li><a href="../BiblioIdentifier.html">BiblioIdentifier</a>
  
    <li><a href="../BiblioIdentifier/Container.html">BiblioIdentifier::Container</a>
  
    <li><a href="../BiblioIdentifier/Note.html">BiblioIdentifier::Note</a>
  
    <li><a href="../BiblioIdentifier/PublicationPerson.html">BiblioIdentifier::PublicationPerson</a>
  
    <li><a href="../BiblioIdentifier/Publisher.html">BiblioIdentifier::Publisher</a>
  
    <li><a href="../BiblioIdentifier/RelatedArticle.html">BiblioIdentifier::RelatedArticle</a>
  
    <li><a href="../BiblioIdentifier/RelatedItem.html">BiblioIdentifier::RelatedItem</a>
  
    <li><a href="../BiblioIdentifier/Reviewee.html">BiblioIdentifier::Reviewee</a>
  
    <li><a href="../BiblioIdentifier/ShortTitle.html">BiblioIdentifier::ShortTitle</a>
  
    <li><a href="../JRubyXML.html">JRubyXML</a>
  
    <li><a href="../JRubyXML/EpiDocP4Validator.html">JRubyXML::EpiDocP4Validator</a>
  
    <li><a href="../JRubyXML/EpiDocP5Validator.html">JRubyXML::EpiDocP5Validator</a>
  
    <li><a href="../JRubyXML/JARVValidator.html">JRubyXML::JARVValidator</a>
  
    <li><a href="../JRubyXML/NamespaceContext.html">JRubyXML::NamespaceContext</a>
  
    <li><a href="../JRubyXML/ParseError.html">JRubyXML::ParseError</a>
  
    <li><a href="../JRubyXML/ParseErrorHandler.html">JRubyXML::ParseErrorHandler</a>
  
    <li><a href="../JRubyXML/RDFValidator.html">JRubyXML::RDFValidator</a>
  
    <li><a href="../JRubyXML/TransformErrorListener.html">JRubyXML::TransformErrorListener</a>
  
    <li><a href="../REXML.html">REXML</a>
  
    <li><a href="../REXML/Document.html">REXML::Document</a>
  
    <li><a href="../REXML/Element.html">REXML::Element</a>
  
    <li><a href="../REXML/XPath.html">REXML::XPath</a>
  
    <li><a href="../NumbersRDF.html">NumbersRDF</a>
  
    <li><a href="../NumbersRDF/NumbersHelper.html">NumbersRDF::NumbersHelper</a>
  
    <li><a href="../NumbersRDF/Timeout.html">NumbersRDF::Timeout</a>
  
    <li><a href="../Rpx.html">Rpx</a>
  
    <li><a href="../Rpx/RpxException.html">Rpx::RpxException</a>
  
    <li><a href="../Rpx/RpxHelper.html">Rpx::RpxHelper</a>
  
    <li><a href="../Comment.html">Comment</a>
  
    <li><a href="../Comment/CombineComment.html">Comment::CombineComment</a>
  
    <li><a href="../Doco.html">Doco</a>
  
    <li><a href="../Doco/DocoNode.html">Doco::DocoNode</a>
  
    <li><a href="../Grit.html">Grit</a>
  
    <li><a href="../Grit/Commit.html">Grit::Commit</a>
  
    <li><a href="../HGVMetaIdentifier.html">HGVMetaIdentifier</a>
  
    <li><a href="../HGVMetaIdentifier/HgvMetaConfiguration.html">HGVMetaIdentifier::HgvMetaConfiguration</a>
  
    <li><a href="../HGVTransGlossary.html">HGVTransGlossary</a>
  
    <li><a href="../HGVTransGlossary/Entry.html">HGVTransGlossary::Entry</a>
  
    <li><a href="../APISIdentifier.html">APISIdentifier</a>
  
    <li><a href="../AjaxProxyController.html">AjaxProxyController</a>
  
    <li><a href="../ApplicationController.html">ApplicationController</a>
  
    <li><a href="../ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="../BiblioFormBuilder.html">BiblioFormBuilder</a>
  
    <li><a href="../BiblioIdentifiersController.html">BiblioIdentifiersController</a>
  
    <li><a href="../Board.html">Board</a>
  
    <li><a href="../BoardsController.html">BoardsController</a>
  
    <li><a href="../CollectionIdentifier.html">CollectionIdentifier</a>
  
    <li><a href="../CollectionIdentifiersController.html">CollectionIdentifiersController</a>
  
    <li><a href="../CommentsController.html">CommentsController</a>
  
    <li><a href="../CommunitiesController.html">CommunitiesController</a>
  
    <li><a href="../Community.html">Community</a>
  
    <li><a href="../CrossSiteController.html">CrossSiteController</a>
  
    <li><a href="../DDBIdentifier.html">DDBIdentifier</a>
  
    <li><a href="../DdbIdentifiersController.html">DdbIdentifiersController</a>
  
    <li><a href="../Decree.html">Decree</a>
  
    <li><a href="../DecreesController.html">DecreesController</a>
  
    <li><a href="../DocosController.html">DocosController</a>
  
    <li><a href="../DocovideosController.html">DocovideosController</a>
  
    <li><a href="../Emailer.html">Emailer</a>
  
    <li><a href="../EmailerMailer.html">EmailerMailer</a>
  
    <li><a href="../EmailersController.html">EmailersController</a>
  
    <li><a href="../Event.html">Event</a>
  
    <li><a href="../EventsController.html">EventsController</a>
  
    <li><a href="../GitConf.html">GitConf</a>
  
    <li><a href="../HGVIdentifier.html">HGVIdentifier</a>
  
    <li><a href="../HGVTransIdentifier.html">HGVTransIdentifier</a>
  
    <li><a href="../HelperController.html">HelperController</a>
  
    <li><a href="../HgvMetaIdentifiersController.html">HgvMetaIdentifiersController</a>
  
    <li><a href="../HgvTransGlossariesController.html">HgvTransGlossariesController</a>
  
    <li><a href="../HgvTransIdentifiersController.html">HgvTransIdentifiersController</a>
  
    <li><a href="../Identifier.html">Identifier</a>
  
    <li><a href="../IdentifiersController.html">IdentifiersController</a>
  
    <li><a href="../Integer.html">Integer</a>
  
    <li><a href="../Leiden.html">Leiden</a>
  
    <li><a href="../LeidenController.html">LeidenController</a>
  
    <li><a href="../LinkingInfo.html">LinkingInfo</a>
  
    <li><a href="../MaintenanceMode.html">MaintenanceMode</a>
  
    <li><a href="../Object.html">Object</a>
  
    <li><a href="../PrettySsime.html">PrettySsime</a>
  
    <li><a href="../Publication.html">Publication</a>
  
    <li><a href="../PublicationsController.html">PublicationsController</a>
  
    <li><a href="../Rails.html">Rails</a>
  
    <li><a href="../RepositoriesController.html">RepositoriesController</a>
  
    <li><a href="../Repository.html">Repository</a>
  
    <li><a href="../RpxController.html">RpxController</a>
  
    <li><a href="../TranslationHelperController.html">TranslationHelperController</a>
  
    <li><a href="../TranslationLeiden.html">TranslationLeiden</a>
  
    <li><a href="../TranslationLeidenController.html">TranslationLeidenController</a>
  
    <li><a href="../User.html">User</a>
  
    <li><a href="../UserController.html">UserController</a>
  
    <li><a href="../UserIdentifier.html">UserIdentifier</a>
  
    <li><a href="../Vote.html">Vote</a>
  
    <li><a href="../VotesController.html">VotesController</a>
  
    <li><a href="../WelcomeController.html">WelcomeController</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation" class="description">
  
<h1 id="label-JRuby+Deployment">JRuby Deployment</h1>

<h2 id="label-Requirements">Requirements</h2>
<ul><li>
<p>Java SE 6 (1.6+)</p>
</li><li>
<p>JRuby (1.3.1+) ”tested on 1.3.1 and 1.4.0”</p>
</li><li>
<p>Git (1.6.1.3+)</p>
</li></ul>

<h2 id="label-Initial+setup+steps+for+development">Initial setup steps for development</h2>
<ul><li>
<p>get source from [<a
href="http://sourceforge.net/projects/sosol/develop">sourceforge.net/projects/sosol/develop</a>
SourceForge] or [<a
href="https://github.com/papyri/sosol">github.com/papyri/sosol</a> GitHub]</p>
</li><li>
<p>copy in/create config/environments/*_secret.rb (where * is development,
test, production - sets RPX_API_KEY and RPX_REALM, can get these by
creating an [<a href="http://www.rpxnow.com/">www.rpxnow.com/</a> RPX]
account)</p>
</li></ul>

<pre>RPX_API_KEY = '0b13c31190219061...'
RPX_REALM = 'SoSOL...'</pre>
<ul><li>
<p>jruby -S gem install capistrano (may not work in JRuby)</p>
</li><li>
<p>cap local externals:setup (pulls in xsugar, EpiDoc XSLT)</p>
</li><li>
<p>jruby -S rake db:migrate</p>
</li><li>
<p>clone canonical.git (jruby -S rake git:db:canonical:clone)</p>
</li><li>
<p>jruby -S rake (run tests, sanity check)</p>
</li><li>
<p>jruby script/server</p>
</li></ul>

<h2 id="label-WAR-based+deployment">WAR-based deployment</h2>
<ul><li>
<p>use warbler to bundle as a standard .war (includes JRuby, gems, etc.) to
upload to an app server</p>
<ul><li>
<p>initialize/migrate your production DB using “RAILS_ENV=production jruby
-S rake db:migrate” (change production line in config/database.yml for
your setup)</p>
</li><li>
<p>may want to add “config.logger = Logger.new(STDOUT)” to
config/environment.rb to get <a href="../Rails.html">Rails</a> logging out
to servlet container</p>
</li><li>
<p>run “cap local externals:setup” to fetch externals</p>
</li><li>
<p>use “jruby -S warble war” to build the war</p>
</li><li>
<p>need to change REPOSITORY_ROOT in config/environment.rb to an absolute
shared path, because packing up the 500MB+ canonical repo in the war will
grind things to a halt</p>
</li></ul>
</li><li>
<p>war unpacking isn’t guaranteed (and multiple deploys would overwrite
changes to the unpacked dir structure anyway) so it seems like alternate
config will be needed</p>
<ul><li>
<p>need a persistent directory for git (overwrite REPOSITORY_ROOT and
CANONICAL_REPOSITORY in production)</p>
</li><li>
<p>DB migrations seem impossible to run from the deployed war context, so
you’ll have to run them pre-deploy using the production environment on
some checkout of the code (meaning it will also need access to your
production DB server credentials)</p>
</li><li>
<p>not sure on logs, sessions (may need extra config for new vers of <a
href="../Rails.html">Rails</a>), rollback (probably impossible to get
easily in a war context due to also needing to reverse migrations)</p>
</li></ul>
</li></ul>

<h2 id="label-Directory-based+deployment">Directory-based deployment</h2>
<ul><li>
<p>deploy an unpacked directory and run within JRuby using any variety of
servers (e.g. jetty-rails, glassfish - N.B. glassfish gem must have all
required jars invoked inside JRuby on the classpath e.g.
lib/java/saxon9he.jar) which can be accessed directly or proxied</p>
</li></ul>

<h1 id="label-Repository+Setup"><a href="../Repository.html">Repository</a> Setup</h1>

<h2 id="label-Canonical+Repository+%28from+Git%29">Canonical <a href="../Repository.html">Repository</a> (from Git)</h2>
<ul><li>
<p>Initialize with:</p>
<ul><li>
<p>git clone –bare git://github.com/papyri/idp.data.git CANONICAL_REPOSITORY</p>
</li><li>
<p>where CANONICAL_REPOSITORY is the path defined in config/environment.rb,
defaulting to REPOSITORY_ROOT/canonical.git. For WAR-based deploy will want
to change REPOSITORY_ROOT to an absolute path as noted.</p>
</li></ul>
</li><li>
<p>Data now also mirrored [<a
href="https://github.com/papyri/idp.data">github.com/papyri/idp.data</a> on
GitHub]</p>
</li></ul>

<h1 id="label-Administration">Administration</h1>
<ul><li>
<p>“jruby script/console production” should give you a console for the
production environment (keep in mind things like DB/Git access, you’ll
need to run this from a location that can access those resources, the
source, and the correct configs for your production environment)</p>
<ul><li>
<p>from here you can give users admin privileges by e.g.:</p>
<ul><li>
<p>me = User.find_by_name(‘rfbaumann’)</p>
</li><li>
<p>me.admin = true</p>
</li><li>
<p>me.save!</p>
</li></ul>
</li></ul>
</li><li>
<p>can completely reset the database with “jruby -S rake
RAILS_ENV=production db:reset”</p>
<ul><li>
<p>note that this ”won’t” run AR callbacks, so you need to clear
user/board git repos:</p>
<ul><li>
<p>if you plan on ”‘keeping”’ canonical (aka repo 3) i.e. not deleting
it and recloning from the Git SVN copy, you need to first ensure that it
has all finalized objects and remove the user repos you’ll delete from
its alternates file:</p>
<ul><li>
<p>cd REPOSITORY_ROOT/canonical.git &amp;&amp; git repack &amp;&amp; echo
“” &gt; objects/info/alternates</p>
</li><li>
<p>can check integrity afterwards with “git fsck”</p>
</li></ul>
</li><li>
<p>rm -rf REPOSITORY_ROOT/boards/*.git REPOSITORY_ROOT/users/*.git</p>
</li></ul>
</li><li>
<p>can also delete every model instance from the console with e.g.
User.find(:all).each{|u| u.destroy} but this can be tedious if there are
loose instances of other models that aren’t dependent-destroyed</p>
</li></ul>
</li></ul>

</div>



<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

