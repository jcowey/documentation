<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>Class: Identifier</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/identifier.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-collection_names">::collection_names</a>
    
    <li><a href="#method-c-new_from_template">::new_from_template</a>
    
    <li><a href="#method-c-next_temporary_identifier">::next_temporary_identifier</a>
    
    <li><a href="#method-i-add_change_desc">#add_change_desc</a>
    
    <li><a href="#method-i-after_rename">#after_rename</a>
    
    <li><a href="#method-i-before_commit">#before_commit</a>
    
    <li><a href="#method-i-branch">#branch</a>
    
    <li><a href="#method-i-children">#children</a>
    
    <li><a href="#method-i-content">#content</a>
    
    <li><a href="#method-i-file_template">#file_template</a>
    
    <li><a href="#method-i-get_commits">#get_commits</a>
    
    <li><a href="#method-i-get_recent_commit_sha">#get_recent_commit_sha</a>
    
    <li><a href="#method-i-is_valid_xml-3F">#is_valid_xml?</a>
    
    <li><a href="#method-i-mutable-3F">#mutable?</a>
    
    <li><a href="#method-i-needs_reviewing-3F">#needs_reviewing?</a>
    
    <li><a href="#method-i-origin">#origin</a>
    
    <li><a href="#method-i-owner">#owner</a>
    
    <li><a href="#method-i-parent">#parent</a>
    
    <li><a href="#method-i-relatives">#relatives</a>
    
    <li><a href="#method-i-rename">#rename</a>
    
    <li><a href="#method-i-repository">#repository</a>
    
    <li><a href="#method-i-result_action_approve">#result_action_approve</a>
    
    <li><a href="#method-i-result_action_graffiti">#result_action_graffiti</a>
    
    <li><a href="#method-i-result_action_reject">#result_action_reject</a>
    
    <li><a href="#method-i-set_content">#set_content</a>
    
    <li><a href="#method-i-set_xml_content">#set_xml_content</a>
    
    <li><a href="#method-i-title">#title</a>
    
    <li><a href="#method-i-titleize">#titleize</a>
    
    <li><a href="#method-i-to_components">#to_components</a>
    
    <li><a href="#method-i-update_revision_desc">#update_revision_desc</a>
    
    <li><a href="#method-i-user_has_voted-3F">#user_has_voted?</a>
    
    <li><a href="#method-i-xml_content">#xml_content</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./HgvMetaIdentifierHelper.html">HgvMetaIdentifierHelper</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvDate.html">HgvMetaIdentifierHelper::HgvDate</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvFormat.html">HgvMetaIdentifierHelper::HgvFormat</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvFuzzy.html">HgvMetaIdentifierHelper::HgvFuzzy</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvGeo.html">HgvMetaIdentifierHelper::HgvGeo</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvGeo/GeoSpot.html">HgvMetaIdentifierHelper::HgvGeo::GeoSpot</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvGeo/Place.html">HgvMetaIdentifierHelper::HgvGeo::Place</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvGeo/Provenance.html">HgvMetaIdentifierHelper::HgvGeo::Provenance</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvMentionedDate.html">HgvMetaIdentifierHelper::HgvMentionedDate</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvProvenance.html">HgvMetaIdentifierHelper::HgvProvenance</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvPublication.html">HgvMetaIdentifierHelper::HgvPublication</a>
  
    <li><a href="./BiblioIdentifier.html">BiblioIdentifier</a>
  
    <li><a href="./BiblioIdentifier/Container.html">BiblioIdentifier::Container</a>
  
    <li><a href="./BiblioIdentifier/Note.html">BiblioIdentifier::Note</a>
  
    <li><a href="./BiblioIdentifier/PublicationPerson.html">BiblioIdentifier::PublicationPerson</a>
  
    <li><a href="./BiblioIdentifier/Publisher.html">BiblioIdentifier::Publisher</a>
  
    <li><a href="./BiblioIdentifier/RelatedArticle.html">BiblioIdentifier::RelatedArticle</a>
  
    <li><a href="./BiblioIdentifier/RelatedItem.html">BiblioIdentifier::RelatedItem</a>
  
    <li><a href="./BiblioIdentifier/Reviewee.html">BiblioIdentifier::Reviewee</a>
  
    <li><a href="./BiblioIdentifier/ShortTitle.html">BiblioIdentifier::ShortTitle</a>
  
    <li><a href="./JRubyXML.html">JRubyXML</a>
  
    <li><a href="./JRubyXML/EpiDocP4Validator.html">JRubyXML::EpiDocP4Validator</a>
  
    <li><a href="./JRubyXML/EpiDocP5Validator.html">JRubyXML::EpiDocP5Validator</a>
  
    <li><a href="./JRubyXML/JARVValidator.html">JRubyXML::JARVValidator</a>
  
    <li><a href="./JRubyXML/NamespaceContext.html">JRubyXML::NamespaceContext</a>
  
    <li><a href="./JRubyXML/ParseError.html">JRubyXML::ParseError</a>
  
    <li><a href="./JRubyXML/ParseErrorHandler.html">JRubyXML::ParseErrorHandler</a>
  
    <li><a href="./JRubyXML/RDFValidator.html">JRubyXML::RDFValidator</a>
  
    <li><a href="./JRubyXML/TransformErrorListener.html">JRubyXML::TransformErrorListener</a>
  
    <li><a href="./REXML.html">REXML</a>
  
    <li><a href="./REXML/Document.html">REXML::Document</a>
  
    <li><a href="./REXML/Element.html">REXML::Element</a>
  
    <li><a href="./REXML/XPath.html">REXML::XPath</a>
  
    <li><a href="./NumbersRDF.html">NumbersRDF</a>
  
    <li><a href="./NumbersRDF/NumbersHelper.html">NumbersRDF::NumbersHelper</a>
  
    <li><a href="./NumbersRDF/Timeout.html">NumbersRDF::Timeout</a>
  
    <li><a href="./Rpx.html">Rpx</a>
  
    <li><a href="./Rpx/RpxException.html">Rpx::RpxException</a>
  
    <li><a href="./Rpx/RpxHelper.html">Rpx::RpxHelper</a>
  
    <li><a href="./Comment.html">Comment</a>
  
    <li><a href="./Comment/CombineComment.html">Comment::CombineComment</a>
  
    <li><a href="./Doco.html">Doco</a>
  
    <li><a href="./Doco/DocoNode.html">Doco::DocoNode</a>
  
    <li><a href="./Grit.html">Grit</a>
  
    <li><a href="./Grit/Commit.html">Grit::Commit</a>
  
    <li><a href="./HGVMetaIdentifier.html">HGVMetaIdentifier</a>
  
    <li><a href="./HGVMetaIdentifier/HgvMetaConfiguration.html">HGVMetaIdentifier::HgvMetaConfiguration</a>
  
    <li><a href="./HGVTransGlossary.html">HGVTransGlossary</a>
  
    <li><a href="./HGVTransGlossary/Entry.html">HGVTransGlossary::Entry</a>
  
    <li><a href="./APISIdentifier.html">APISIdentifier</a>
  
    <li><a href="./AjaxProxyController.html">AjaxProxyController</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./BiblioFormBuilder.html">BiblioFormBuilder</a>
  
    <li><a href="./BiblioIdentifiersController.html">BiblioIdentifiersController</a>
  
    <li><a href="./Board.html">Board</a>
  
    <li><a href="./BoardsController.html">BoardsController</a>
  
    <li><a href="./CollectionIdentifier.html">CollectionIdentifier</a>
  
    <li><a href="./CollectionIdentifiersController.html">CollectionIdentifiersController</a>
  
    <li><a href="./CommentsController.html">CommentsController</a>
  
    <li><a href="./CommunitiesController.html">CommunitiesController</a>
  
    <li><a href="./Community.html">Community</a>
  
    <li><a href="./CrossSiteController.html">CrossSiteController</a>
  
    <li><a href="./DDBIdentifier.html">DDBIdentifier</a>
  
    <li><a href="./DdbIdentifiersController.html">DdbIdentifiersController</a>
  
    <li><a href="./Decree.html">Decree</a>
  
    <li><a href="./DecreesController.html">DecreesController</a>
  
    <li><a href="./DocosController.html">DocosController</a>
  
    <li><a href="./DocovideosController.html">DocovideosController</a>
  
    <li><a href="./Emailer.html">Emailer</a>
  
    <li><a href="./EmailerMailer.html">EmailerMailer</a>
  
    <li><a href="./EmailersController.html">EmailersController</a>
  
    <li><a href="./Event.html">Event</a>
  
    <li><a href="./EventsController.html">EventsController</a>
  
    <li><a href="./GitConf.html">GitConf</a>
  
    <li><a href="./HGVIdentifier.html">HGVIdentifier</a>
  
    <li><a href="./HGVTransIdentifier.html">HGVTransIdentifier</a>
  
    <li><a href="./HelperController.html">HelperController</a>
  
    <li><a href="./HgvMetaIdentifiersController.html">HgvMetaIdentifiersController</a>
  
    <li><a href="./HgvTransGlossariesController.html">HgvTransGlossariesController</a>
  
    <li><a href="./HgvTransIdentifiersController.html">HgvTransIdentifiersController</a>
  
    <li><a href="./Identifier.html">Identifier</a>
  
    <li><a href="./IdentifiersController.html">IdentifiersController</a>
  
    <li><a href="./Integer.html">Integer</a>
  
    <li><a href="./Leiden.html">Leiden</a>
  
    <li><a href="./LeidenController.html">LeidenController</a>
  
    <li><a href="./LinkingInfo.html">LinkingInfo</a>
  
    <li><a href="./MaintenanceMode.html">MaintenanceMode</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./PrettySsime.html">PrettySsime</a>
  
    <li><a href="./Publication.html">Publication</a>
  
    <li><a href="./PublicationsController.html">PublicationsController</a>
  
    <li><a href="./Rails.html">Rails</a>
  
    <li><a href="./RepositoriesController.html">RepositoriesController</a>
  
    <li><a href="./Repository.html">Repository</a>
  
    <li><a href="./RpxController.html">RpxController</a>
  
    <li><a href="./TranslationHelperController.html">TranslationHelperController</a>
  
    <li><a href="./TranslationLeiden.html">TranslationLeiden</a>
  
    <li><a href="./TranslationLeidenController.html">TranslationLeidenController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserController.html">UserController</a>
  
    <li><a href="./UserIdentifier.html">UserIdentifier</a>
  
    <li><a href="./Vote.html">Vote</a>
  
    <li><a href="./VotesController.html">VotesController</a>
  
    <li><a href="./WelcomeController.html">WelcomeController</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Identifier</h1>

  <div id="description" class="description">
    <ul><li>
<p>Super-class of all identifiers</p>
</li></ul>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="FRIENDLY_NAME">FRIENDLY_NAME
        
        <dd class="description">
        
      
        <dt id="IDENTIFIER_STATUS">IDENTIFIER_STATUS
        
        <dd class="description">
        
      
        <dt id="IDENTIFIER_SUBCLASSES">IDENTIFIER_SUBCLASSES
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-collection_names" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">collection_names</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Creates an array of all the collection names for the associated identifier
class (HGV, DDB, APIS)</p>
<ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>array of collection names</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="collection_names-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 194</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">collection_names</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-keyword">defined?</span> <span class="ruby-ivar">@collection_names</span>
    <span class="ruby-identifier">parts</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span><span class="ruby-operator">::</span><span class="ruby-identifier">identifier_to_parts</span>([<span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NAMESPACE_IDENTIFIER</span>, <span class="ruby-keyword">self</span><span class="ruby-operator">::</span><span class="ruby-constant">IDENTIFIER_NAMESPACE</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">'/'</span>))
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">Timeout</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@collection_names</span> = <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span><span class="ruby-operator">::</span><span class="ruby-identifier">identifier_to_components</span>(<span class="ruby-identifier">p</span>).<span class="ruby-identifier">last</span>}
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@collection_names</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- collection_names-source -->
          
        </div>

        

        
      </div><!-- collection_names-method -->

    
      <div id="method-c-new_from_template" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_from_template</span><span
            class="method-args">(publication)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Create default XML file and identifier model entry for associated
identifier class</p>
<ul><li>
<p><strong>Args</strong>  :</p>
<ul><li>
<p><code>publication</code> -&gt; the publication the new translation is a
part of</p>
</li></ul>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>new identifier</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="new_from_template-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 208</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_from_template</span>(<span class="ruby-identifier">publication</span>)
  <span class="ruby-identifier">new_identifier</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">next_temporary_identifier</span>)
  <span class="ruby-identifier">new_identifier</span>.<span class="ruby-identifier">publication</span> = <span class="ruby-identifier">publication</span>
  
  <span class="ruby-identifier">new_identifier</span>.<span class="ruby-identifier">save!</span>
  
  <span class="ruby-identifier">initial_content</span> = <span class="ruby-identifier">new_identifier</span>.<span class="ruby-identifier">file_template</span>
  <span class="ruby-identifier">new_identifier</span>.<span class="ruby-identifier">set_content</span>(<span class="ruby-identifier">initial_content</span>, <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Created from SoSOL template'</span>)
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">new_identifier</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new_from_template-source -->
          
        </div>

        

        
      </div><!-- new_from_template-method -->

    
      <div id="method-c-next_temporary_identifier" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">next_temporary_identifier</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Determines the next ‘SoSOL’ temporary name for the associated
identifier</p>
<ul><li>
<p>starts at ‘1’ each year</p>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>temporary identifier name</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="next_temporary_identifier-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 240</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">next_temporary_identifier</span>
  <span class="ruby-identifier">year</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">year</span>
  <span class="ruby-identifier">latest</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,
                     <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;name like ?&quot;</span>, <span class="ruby-node">&quot;papyri.info/#{self::IDENTIFIER_NAMESPACE}/#{self::TEMPORARY_COLLECTION};#{year};%&quot;</span>],
                     <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;name DESC&quot;</span>,
                     <span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment"># no constructed id's for this year/class</span>
    <span class="ruby-identifier">document_number</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">document_number</span> = <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">to_components</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">';'</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-node">&quot;papyri.info/#{self::IDENTIFIER_NAMESPACE}/#{self::TEMPORARY_COLLECTION};%04d;%04d&quot;</span>,
                 <span class="ruby-identifier">year</span>, <span class="ruby-identifier">document_number</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- next_temporary_identifier-source -->
          
        </div>

        

        
      </div><!-- next_temporary_identifier-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-add_change_desc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_change_desc</span><span
            class="method-args">(text = "", user_info = self.publication.creator, input_content = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Add a ‘change’ tag into the tei:revisionDesc of the identifer’s XML
file via XSLT</p>
<ul><li>
<p>does not do a commit - just modifies XML and returns it</p>
</li><li>
<p><strong>Args</strong>  :</p>
<ul><li>
<p><code>text</code> -&gt; the comment the user/system has provided</p>
</li><li>
<p><code>user_info</code> -&gt;  used in the ‘who’ attribute of the
‘change’ tag if give, otherwise uses the publications creator</p>
</li><li>
<p><code>input_content</code> -&gt; the XML you want this added to, otherwise
pulls it from the repository for this identifier</p>
</li></ul>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>string of the XML containing the added ‘change’ tag</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="add_change_desc-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 400</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_change_desc</span>(<span class="ruby-identifier">text</span> = <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">user_info</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">creator</span>, <span class="ruby-identifier">input_content</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">doc</span> = <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
    <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-identifier">input_content</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">xml_content</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">input_content</span>),
    <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
      <span class="ruby-node">%w{data xslt common add_change.xsl}</span>)),
    <span class="ruby-value">:who</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Integration</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">url_for</span>(<span class="ruby-value">:host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NAMESPACE_IDENTIFIER</span>, <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'user'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'show'</span>, <span class="ruby-value">:user_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_info</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value">:only_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>),
    <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>
  )
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">to_s</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_change_desc-source -->
          
        </div>

        

        
      </div><!-- add_change_desc-method -->

    
      <div id="method-i-after_rename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">after_rename</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Place anything actions you need performed on all identifiers after a
‘rename’ has occurred</p>
<ul><li>
<p>nothin in here at this time</p>
</li></ul>
          

          
          <div class="method-source-code" id="after_rename-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 376</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">after_rename</span>(<span class="ruby-identifier">options</span> = {})
<span class="ruby-keyword">end</span></pre>
          </div><!-- after_rename-source -->
          
        </div>

        

        
      </div><!-- after_rename-method -->

    
      <div id="method-i-before_commit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">before_commit</span><span
            class="method-args">(content)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Put stuff in here you want to do do all identifiers before a commit is done</p>
<ul><li>
<p>currently no logic is in here - just returns whatever was passed in</p>
</li></ul>
          

          
          <div class="method-source-code" id="before_commit-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">before_commit</span>(<span class="ruby-identifier">content</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">content</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- before_commit-source -->
          
        </div>

        

        
      </div><!-- before_commit-method -->

    
      <div id="method-i-branch" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">branch</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>the repository branch for this identifier</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="branch-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">branch</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-string">'master'</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">branch</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- branch-source -->
          
        </div>

        

        
      </div><!-- branch-method -->

    
      <div id="method-i-children" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">children</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>all the children of the publication that contains this identifier</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="children-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">children</span>
  <span class="ruby-identifier">child_identifiers</span> = []
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child_pub</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">child_identifiers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child_pub</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">detect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">type</span>}
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">child_identifiers</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- children-source -->
          
        </div>

        

        
      </div><!-- children-method -->

    
      <div id="method-i-content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">content</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>the cotent of the file containing this identifier from the repository</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="content-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">content</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">repository</span>.<span class="ruby-identifier">get_file_from_branch</span>(
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_path</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- content-source -->
          
        </div>

        

        
      </div><!-- content-method -->

    
      <div id="method-i-file_template" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_template</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Creates ERB file from retrieved default XML file template for the
associated identifier class</p>
<ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>template</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="file_template-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 223</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_template</span>
  <span class="ruby-identifier">template_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>, [<span class="ruby-string">'data'</span>,<span class="ruby-string">'templates'</span>],
                            <span class="ruby-node">&quot;#{self.class.to_s.underscore}.xml.erb&quot;</span>)
  
  <span class="ruby-identifier">template</span> = <span class="ruby-constant">ERB</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">template_path</span>).<span class="ruby-identifier">read</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">'-'</span>)
  
  <span class="ruby-identifier">id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id_attribute</span>
  <span class="ruby-identifier">n</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">n_attribute</span>
  <span class="ruby-identifier">title</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">xml_title_text</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">result</span>(<span class="ruby-identifier">binding</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- file_template-source -->
          
        </div>

        

        
      </div><!-- file_template-method -->

    
      <div id="method-i-get_commits" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_commits</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Retrieve the commits made to a file in the repository</p>
<ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>array of commits</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="get_commits-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_commits</span>
  <span class="ruby-keyword">self</span>[<span class="ruby-value">:commits</span>] = 
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">repository</span>.<span class="ruby-identifier">get_log_for_file_from_branch</span>(
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_path</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_commits-source -->
          
        </div>

        

        
      </div><!-- get_commits-method -->

    
      <div id="method-i-get_recent_commit_sha" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_recent_commit_sha</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Parse out most recent sha from log</p>
<ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>id of latest commit as a string</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="get_recent_commit_sha-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_recent_commit_sha</span>
  <span class="ruby-identifier">commits</span> = <span class="ruby-identifier">get_commits</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">commits</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">commits</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">commits</span>[<span class="ruby-value">0</span>][<span class="ruby-value">:id</span>].<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_recent_commit_sha-source -->
          
        </div>

        

        
      </div><!-- get_recent_commit_sha-method -->

    
      <div id="method-i-is_valid_xml-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_valid_xml?</span><span
            class="method-args">(content = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Validation of indentifier XML file against tei-epidoc.rng file</p>
<ul><li>
<p><strong>Args</strong>  :</p>
<ul><li>
<p><code>content</code> -&gt; XML to validate if passed in, pulled from
repository if not passed in</p>
</li></ul>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>true/false</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="is_valid_xml-3F-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_valid_xml?</span>(<span class="ruby-identifier">content</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">content</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">content</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">xml_content</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">XML_VALIDATOR</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">validate</span>(
    <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">input_source_from_string</span>(<span class="ruby-identifier">content</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_valid_xml-3F-source -->
          
        </div>

        

        
      </div><!-- is_valid_xml-3F-method -->

    
      <div id="method-i-mutable-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutable?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Determines who can edit the identifier</p>
<ul><li>
<p>owner can edit any of their stuff if it is not submitted</p>
</li><li>
<p>only let the board edit if they own it</p>
</li><li>
<p>let the finalizer edit the identifier the board owns</p>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>true/false</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="mutable-3F-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutable?</span>
 
  <span class="ruby-comment">#only let the board edit if they own it</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Board&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;editing&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">identifier_classes</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>)
     <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#let the finalizer edit the id the board owns  </span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;finalizing&quot;</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">find_first_board</span>.<span class="ruby-identifier">identifier_classes</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> 
    
  <span class="ruby-comment">#they can edit any of their stuff if it is not submitted      </span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;User&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-node">%w{editing new}</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">status</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> 
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>    

<span class="ruby-keyword">end</span></pre>
          </div><!-- mutable-3F-source -->
          
        </div>

        

        
      </div><!-- mutable-3F-method -->

    
      <div id="method-i-needs_reviewing-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">needs_reviewing?</span><span
            class="method-args">(user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Determines if identifier in board members dashboard needs reviewing by that
member</p>
<ul><li>
<p><strong>Returns</strong></p>
<ul><li>
<p><code>true</code> if the identifier needs reviewing</p>
</li><li>
<p><code>false</code> if does not need reviewing</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="needs_reviewing-3F-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 463</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">needs_reviewing?</span>(<span class="ruby-identifier">user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">modified?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;voting&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Board&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">controls_identifier?</span>(<span class="ruby-keyword">self</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">user_has_voted?</span>(<span class="ruby-identifier">user_id</span>) <span class="ruby-comment">#!self.user_has_voted?(user_id)</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- needs_reviewing-3F-source -->
          
        </div>

        

        
      </div><!-- needs_reviewing-3F-method -->

    
      <div id="method-i-origin" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">origin</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>the originally created publication of this identifier (publciation that
does not have a parent id)</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="origin-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">origin</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">origin</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">type</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- origin-source -->
          
        </div>

        

        
      </div><!-- origin-method -->

    
      <div id="method-i-owner" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">owner</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Determines the user who own’s this identifer based on the publication it
is a part of</p>
<ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>identifier owner</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="owner-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 260</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">owner</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- owner-source -->
          
        </div>

        

        
      </div><!-- owner-method -->

    
      <div id="method-i-parent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parent</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>the parent publication of this identifier</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="parent-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 34</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parent</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">type</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- parent-source -->
          
        </div>

        

        
      </div><!-- parent-method -->

    
      <div id="method-i-relatives" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">relatives</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>this idenfiers origin publication and the origin children, but not self</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="relatives-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">relatives</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">origin</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">return</span> []
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">origin</span>] <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">origin</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">-</span> [<span class="ruby-keyword">self</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- relatives-source -->
          
        </div>

        

        
      </div><!-- relatives-method -->

    
      <div id="method-i-rename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rename</span><span
            class="method-args">(new_name, options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Used to rename an identifier from the ‘SoSOL’ temporary name to the
correct ‘collection’ name</p>
<ul><li>
<p>also renames and ‘relatives’ of the identifier</p>
</li><li>
<p><strong>Args</strong>  :</p>
<ul><li>
<p><code>new_name</code> -&gt; name the finalizer has provided</p>
</li><li>
<p><code>options</code> -&gt; hash of options to pass to repository (ex. -
:comment, :actor)</p>
</li></ul>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>a String of the SHA1 of the commit</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="rename-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 335</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rename</span>(<span class="ruby-identifier">new_name</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">original</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clone</span>
  <span class="ruby-identifier">options</span>[<span class="ruby-value">:original</span>] = <span class="ruby-identifier">original</span>
  
  <span class="ruby-identifier">original_name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>
  <span class="ruby-identifier">original_path</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_path</span>
  <span class="ruby-identifier">original_relatives</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">relatives</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">new_name</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">titleize</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save!</span>
  
    <span class="ruby-identifier">new_path</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_path</span>
    <span class="ruby-identifier">commit_message</span> = <span class="ruby-node">&quot;Rename #{self.class::FRIENDLY_NAME} from '#{original_name}' (#{original_path}) to '#{new_name}' (#{new_path})&quot;</span>
  
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">repository</span>.<span class="ruby-identifier">rename_file</span>(<span class="ruby-identifier">original_path</span>,
                                <span class="ruby-identifier">new_path</span>,
                                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>,
                                <span class="ruby-identifier">commit_message</span>,
                                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">grit_actor</span>)
    
    <span class="ruby-comment"># rename origin and children</span>
    <span class="ruby-identifier">original_relatives</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">relative</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">relative</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">new_name</span>
      <span class="ruby-identifier">relative</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span>
      <span class="ruby-identifier">relative</span>.<span class="ruby-identifier">save!</span>
      
      <span class="ruby-comment"># rename the file on the relative</span>
      <span class="ruby-identifier">relative</span>.<span class="ruby-identifier">repository</span>.<span class="ruby-identifier">rename_file</span>(<span class="ruby-identifier">original_path</span>,
                                      <span class="ruby-identifier">new_path</span>,
                                      <span class="ruby-identifier">relative</span>.<span class="ruby-identifier">branch</span>,
                                      <span class="ruby-identifier">commit_message</span>,
                                      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">grit_actor</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">after_rename</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- rename-source -->
          
        </div>

        

        
      </div><!-- rename-method -->

    
      <div id="method-i-repository" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repository</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>the repository for the owner of this identifier</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="repository-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repository</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Repository</span>.<span class="ruby-identifier">new</span>() <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">repository</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repository-source -->
          
        </div>

        

        
      </div><!-- repository-method -->

    
      <div id="method-i-result_action_approve" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">result_action_approve</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>See documentation of result_actions method of board model</p>
          

          
          <div class="method-source-code" id="result_action_approve-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 441</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">result_action_approve</span>
 
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&quot;approved&quot;</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">send_to_finalizer</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- result_action_approve-source -->
          
        </div>

        

        
      </div><!-- result_action_approve-method -->

    
      <div id="method-i-result_action_graffiti" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">result_action_graffiti</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>See documentation of result_actions method of board model</p>
          

          
          <div class="method-source-code" id="result_action_graffiti-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 454</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">result_action_graffiti</span>
  
  <span class="ruby-comment">#delete</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- result_action_graffiti-source -->
          
        </div>

        

        
      </div><!-- result_action_graffiti-method -->

    
      <div id="method-i-result_action_reject" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">result_action_reject</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>See documentation of result_actions method of board model</p>
          

          
          <div class="method-source-code" id="result_action_reject-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 448</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">result_action_reject</span>
 
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&quot;rejected&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- result_action_reject-source -->
          
        </div>

        

        
      </div><!-- result_action_reject-method -->

    
      <div id="method-i-set_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_content</span><span
            class="method-args">(content, options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Commits identifier XML to the repository</p>
<ul><li>
<p><strong>Args</strong>  :</p>
<ul><li>
<p><code>content</code> -&gt; the XML you want committed to the repository</p>
</li><li>
<p><code>options</code> -&gt; hash of options to pass to repository (ex. -
:comment, :actor)</p>
</li></ul>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>a String of the SHA1 of the commit</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="set_content-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 102</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_content</span>(<span class="ruby-identifier">content</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">reverse_merge!</span> <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">''</span>
  <span class="ruby-identifier">commit_sha</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">repository</span>.<span class="ruby-identifier">commit_content</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_path</span>,
                                 <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>,
                                 <span class="ruby-identifier">content</span>,
                                 <span class="ruby-identifier">options</span>[<span class="ruby-value">:comment</span>],
                                 <span class="ruby-identifier">options</span>[<span class="ruby-value">:actor</span>])
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">modified</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save!</span> <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:updated_at</span>, <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>) <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">commit_sha</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_content-source -->
          
        </div>

        

        
      </div><!-- set_content-method -->

    
      <div id="method-i-set_xml_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_xml_content</span><span
            class="method-args">(content, options)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Commits identifier XML to the repository vis <a
href="Identifier.html#method-i-set_content">#set_content</a></p>
<ul><li>
<p><strong>Args</strong>  :</p>
<ul><li>
<p><code>content</code> -&gt; the XML you want committed to the repository</p>
</li><li>
<p><code>options</code> -&gt; hash of options to pass to repository (ex. -
:comment, :actor)</p>
</li></ul>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>a String of the SHA1 of the commit</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="set_xml_content-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 308</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">content</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">default_actor</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span>((<span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">User</span>))
    <span class="ruby-identifier">default_actor</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">grit_actor</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">reverse_merge!</span>(
    <span class="ruby-value">:validate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-value">:actor</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">default_actor</span>)
    
  <span class="ruby-identifier">content</span> = <span class="ruby-identifier">before_commit</span>(<span class="ruby-identifier">content</span>)

  <span class="ruby-identifier">commit_sha</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:validate</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_valid_xml?</span>(<span class="ruby-identifier">content</span>)
    <span class="ruby-identifier">commit_sha</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_content</span>(<span class="ruby-identifier">content</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">commit_sha</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_xml_content-source -->
          
        </div>

        

        
      </div><!-- set_xml_content-method -->

    
      <div id="method-i-title" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">title</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Added to speed up dashboard since titleize can be slow</p>
<ul><li>
<p>gets the title from the identifier model if it exists, otherwise creates it
using titleize and saves it in the model</p>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>title from identifer model</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="title-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 384</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">title</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">read_attribute</span>(<span class="ruby-value">:title</span>).<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">write_attribute</span>(<span class="ruby-value">:title</span>,<span class="ruby-keyword">self</span>.<span class="ruby-identifier">titleize</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">read_attribute</span>(<span class="ruby-value">:title</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- title-source -->
          
        </div>

        

        
      </div><!-- title-method -->

    
      <div id="method-i-titleize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">titleize</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Create consistent title for identifiers</p>
<ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>title of identifier</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="titleize-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 142</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">titleize</span>
  <span class="ruby-identifier">title</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">HGVMetaIdentifier</span>
    <span class="ruby-identifier">title</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span><span class="ruby-operator">::</span><span class="ruby-identifier">identifier_to_title</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">HGVTransIdentifier</span>
    <span class="ruby-identifier">title</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span><span class="ruby-operator">::</span><span class="ruby-identifier">identifier_to_title</span>(
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/trans/</span>,<span class="ruby-string">''</span>))
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">DDBIdentifier</span>) <span class="ruby-operator">||</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/#{self.class::TEMPORARY_COLLECTION}/</span>)
      <span class="ruby-identifier">collection_name</span>, <span class="ruby-identifier">volume_number</span>, <span class="ruby-identifier">document_number</span> =
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_components</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">';'</span>)

      <span class="ruby-identifier">collection_name</span> = 
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">collection_names_hash</span>[<span class="ruby-identifier">collection_name</span>]
      
      <span class="ruby-comment"># strip leading zeros</span>
      <span class="ruby-identifier">document_number</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/^0*/</span>,<span class="ruby-string">''</span>)

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">collection_name</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">title</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'/'</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">title</span> = 
         [<span class="ruby-identifier">collection_name</span>, <span class="ruby-identifier">volume_number</span>, <span class="ruby-identifier">document_number</span>].<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">blank?</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">' '</span>)
       <span class="ruby-keyword">end</span>
       
       <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-string">&quot;is_reprinted?&quot;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_reprinted?</span>
         <span class="ruby-identifier">title</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot; (reprinted)&quot;</span>
       <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span> <span class="ruby-comment"># HGV with no name</span>
      <span class="ruby-identifier">title</span> =  [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">FRIENDLY_NAME</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'/'</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-string">';'</span>,<span class="ruby-string">' '</span>)].<span class="ruby-identifier">join</span>(<span class="ruby-string">' '</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">title</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- titleize-source -->
          
        </div>

        

        
      </div><!-- titleize-method -->

    
      <div id="method-i-to_components" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_components</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Splits out identifier file path from the identifier model name field into
the separate components</p>
<ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>components</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="to_components-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_components</span>
  <span class="ruby-identifier">trimmed_name</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span><span class="ruby-operator">::</span><span class="ruby-identifier">identifier_to_local_identifier</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>)
  <span class="ruby-comment"># trimmed_name.sub!(/^\/#{self.class::IDENTIFIER_NAMESPACE}\//,'')</span>
  <span class="ruby-identifier">components</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span><span class="ruby-operator">::</span><span class="ruby-identifier">identifier_to_components</span>(<span class="ruby-identifier">trimmed_name</span>)
  <span class="ruby-identifier">components</span>.<span class="ruby-identifier">map!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">to_s</span>}

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">components</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- to_components-source -->
          
        </div>

        

        
      </div><!-- to_components-method -->

    
      <div id="method-i-update_revision_desc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_revision_desc</span><span
            class="method-args">(comment_text, user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Add a ‘change’ tags to the tei:revisionDesc of the identifer’s XML
file via XSLT during the finalization process</p>
<ul><li>
<p>add a ‘change’ tag for each vote on the identifier</p>
</li><li>
<p>add a ‘change’ tag for finalization message</p>
</li><li>
<p>build a commit message that contains the voting comments/users and
finalzation comment/user</p>
</li><li>
<p>commits the additions to the repository</p>
</li><li>
<p><strong>Args</strong>  :</p>
<ul><li>
<p><code>comment_text</code> -&gt; the comment the user has provided</p>
</li><li>
<p><code>user</code> -&gt;  the ‘user’ that supplied the comment - used in
the ‘who’ attribute of the ‘change’ tag</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="update_revision_desc-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 420</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_revision_desc</span>(<span class="ruby-identifier">comment_text</span>, <span class="ruby-identifier">user</span>)
  <span class="ruby-identifier">commit_message</span> = <span class="ruby-string">&quot;Update revisionDesc\n\n&quot;</span>
  <span class="ruby-identifier">change_desc_content</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">xml_content</span>
  
  <span class="ruby-comment"># assume context is from finalizing publication, so parent is board's copy</span>
  <span class="ruby-identifier">parent_classes</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">identifier_classes</span>
  
  <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">find_all_by_publication_id</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">origin</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span>((<span class="ruby-identifier">c</span>.<span class="ruby-identifier">reason</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;vote&quot;</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">parent_classes</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">identifier</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>)))
      <span class="ruby-identifier">change_desc_content</span> = <span class="ruby-identifier">add_change_desc</span>( <span class="ruby-string">&quot;Vote - &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">comment</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">user</span>, <span class="ruby-identifier">change_desc_content</span> )
      <span class="ruby-identifier">commit_message</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; - Vote - #{c.comment} (#{c.user.human_name})\n&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">change_desc_content</span> = <span class="ruby-identifier">add_change_desc</span>( <span class="ruby-string">&quot;Finalized - &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">comment_text</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">change_desc_content</span>)
  <span class="ruby-identifier">commit_message</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; - Finalized - #{comment_text} (#{user.human_name})&quot;</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">change_desc_content</span>, <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">commit_message</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_revision_desc-source -->
          
        </div>

        

        
      </div><!-- update_revision_desc-method -->

    
      <div id="method-i-user_has_voted-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_has_voted?</span><span
            class="method-args">(user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Determines whether a specified user has voted on this identifier or not</p>
<ul><li>
<p><strong>Args</strong>  :</p>
<ul><li>
<p><code>user_id</code> -&gt; the id of the user checking to see if voted or
not</p>
</li></ul>
</li><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>true/false</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="user_has_voted-3F-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 472</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_has_voted?</span>(<span class="ruby-identifier">user_id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">votes</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">votes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vote</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">vote</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user_id</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-comment">#user has a vote on record for this identifier</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#no vote found</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- user_has_voted-3F-source -->
          
        </div>

        

        
      </div><!-- user_has_voted-3F-method -->

    
      <div id="method-i-xml_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">xml_content</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Returns</strong> :</p>
<ul><li>
<p>the content of the associated identifier’s XML file</p>
</li></ul>
</li></ul>
          

          
          <div class="method-source-code" id="xml_content-source">
            <pre><span class="ruby-comment"># File app/models/identifier.rb, line 298</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">xml_content</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">content</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- xml_content-source -->
          
        </div>

        

        
      </div><!-- xml_content-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

