<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: HGVTransIdentifier</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">HGVTransIdentifier</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/hgv_trans_identifier_rb.html">
                app/models/hgv_trans_identifier.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="HGVIdentifier.html">
                HGVIdentifier
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000342">after_rename</a>&nbsp;&nbsp;
      <a href="#M000339">before_commit</a>&nbsp;&nbsp;
      <a href="#M000344">get_broken_leiden</a>&nbsp;&nbsp;
      <a href="#M000333">id_attribute</a>&nbsp;&nbsp;
      <a href="#M000336">is_valid?</a>&nbsp;&nbsp;
      <a href="#M000345">leiden_trans</a>&nbsp;&nbsp;
      <a href="#M000347">leiden_translation_to_xml</a>&nbsp;&nbsp;
      <a href="#M000334">n_attribute</a>&nbsp;&nbsp;
      <a href="#M000337">new_from_template</a>&nbsp;&nbsp;
      <a href="#M000343">preview</a>&nbsp;&nbsp;
      <a href="#M000338">related_text</a>&nbsp;&nbsp;
      <a href="#M000348">save_broken_leiden_trans_to_xml</a>&nbsp;&nbsp;
      <a href="#M000346">set_leiden_translation_content</a>&nbsp;&nbsp;
      <a href="#M000341">stub_text_structure</a>&nbsp;&nbsp;
      <a href="#M000332">to_path</a>&nbsp;&nbsp;
      <a href="#M000340">translation_already_in_language?</a>&nbsp;&nbsp;
      <a href="#M000335">xml_title_text</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">PATH_PREFIX</td>
          <td>=</td>
          <td class="context-item-value">'HGV_trans_EpiDoc'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">IDENTIFIER_NAMESPACE</td>
          <td>=</td>
          <td class="context-item-value">'hgvtrans'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">XML_VALIDATOR</td>
          <td>=</td>
          <td class="context-item-value">JRubyXML::EpiDocP5Validator</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FRIENDLY_NAME</td>
          <td>=</td>
          <td class="context-item-value">&quot;Translation&quot;</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">BROKE_LEIDEN_MESSAGE</td>
          <td>=</td>
          <td class="context-item-value">&quot;Broken Leiden+ below saved to come back to later:\n&quot;</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000337" class="method-detail">
        <a name="M000337"></a>

        <div class="method-heading">
          <a href="#M000337" class="method-signature">
          <span class="method-name">new_from_template</span><span class="method-args">(publication)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000337-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000337-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 51</span>
51:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_from_template</span>(<span class="ruby-identifier">publication</span>)
52:     <span class="ruby-identifier">new_identifier</span> = <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">publication</span>)
53:     
54:     <span class="ruby-identifier">new_identifier</span>.<span class="ruby-identifier">stub_text_structure</span>(<span class="ruby-value str">'en'</span>)
55:     
56:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">new_identifier</span>
57:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000342" class="method-detail">
        <a name="M000342"></a>

        <div class="method-heading">
          <a href="#M000342" class="method-signature">
          <span class="method-name">after_rename</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000342-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000342-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 107</span>
107:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_rename</span>(<span class="ruby-identifier">options</span> = {})
108:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:update_header</span>]
109:       <span class="ruby-identifier">related_hgv</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_components</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">HGVMetaIdentifier</span>}.<span class="ruby-identifier">compact</span>
110:       <span class="ruby-identifier">rewritten_xml</span> =
111:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
112:           <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-identifier">content</span>),
113:           <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
114:             <span class="ruby-node">%w{data xslt translation update_header.xsl}</span>)),
115:           <span class="ruby-identifier">:filename_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_components</span>.<span class="ruby-identifier">last</span>,
116:           <span class="ruby-identifier">:HGV_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">related_hgv</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>),
117:           <span class="ruby-identifier">:TM_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">related_hgv</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\D/</span>,<span class="ruby-value str">''</span>)}.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>),
118:           <span class="ruby-identifier">:title_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span><span class="ruby-operator">::</span><span class="ruby-identifier">identifier_to_title</span>([<span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NAMESPACE_IDENTIFIER</span>,<span class="ruby-constant">HGVIdentifier</span><span class="ruby-operator">::</span><span class="ruby-constant">IDENTIFIER_NAMESPACE</span>,<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_components</span>.<span class="ruby-identifier">last</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">'/'</span>)),
119:           <span class="ruby-identifier">:reprint_from_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:set_dummy_header</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>,
120:           <span class="ruby-identifier">:reprint_ref_attribute</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:set_dummy_header</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">to_components</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>
121:         )
122:     
123:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">rewritten_xml</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;Update header to reflect new identifier '#{self.name}'&quot;</span>)
124:     <span class="ruby-keyword kw">end</span>
125:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000339" class="method-detail">
        <a name="M000339"></a>

        <div class="method-heading">
          <a href="#M000339" class="method-signature">
          <span class="method-name">before_commit</span><span class="method-args">(content)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000339-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000339-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 63</span>
63:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_commit</span>(<span class="ruby-identifier">content</span>)
64:     <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
65:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-identifier">content</span>),
66:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
67:         <span class="ruby-node">%w{data xslt translation preprocess.xsl}</span>))
68:     )
69:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000344" class="method-detail">
        <a name="M000344"></a>

        <div class="method-heading">
          <a href="#M000344" class="method-signature">
          <span class="method-name">get_broken_leiden</span><span class="method-args">(original_xml = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000344-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000344-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 134</span>
134:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_broken_leiden</span>(<span class="ruby-identifier">original_xml</span> = <span class="ruby-keyword kw">nil</span>)
135:     <span class="ruby-identifier">original_xml_content</span> = <span class="ruby-identifier">original_xml</span> <span class="ruby-operator">||</span> <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)
136:     <span class="ruby-identifier">brokeleiden_path</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;translation&quot;]/div[@subtype = &quot;brokeleiden&quot;]/note'</span>
137:     <span class="ruby-identifier">brokeleiden_here</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">original_xml_content</span>, <span class="ruby-identifier">brokeleiden_path</span>)
138:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">brokeleiden_here</span>.<span class="ruby-identifier">nil?</span>
139:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
140:     <span class="ruby-keyword kw">else</span>
141:       <span class="ruby-identifier">brokeleiden</span> = <span class="ruby-identifier">brokeleiden_here</span>.<span class="ruby-identifier">get_text</span>.<span class="ruby-identifier">value</span>
142:       
143:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">brokeleiden</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">/^#{Regexp.escape(BROKE_LEIDEN_MESSAGE)}/</span>,<span class="ruby-value str">''</span>)
144:     <span class="ruby-keyword kw">end</span>
145:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000333" class="method-detail">
        <a name="M000333"></a>

        <div class="method-heading">
          <a href="#M000333" class="method-signature">
          <span class="method-name">id_attribute</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000333-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000333-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 33</span>
33:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">id_attribute</span>
34:     <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;hgv-TEMP&quot;</span>
35:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000336" class="method-detail">
        <a name="M000336"></a>

        <div class="method-heading">
          <a href="#M000336" class="method-signature">
          <span class="method-name">is_valid?</span><span class="method-args">(content = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000336-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000336-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 46</span>
46:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_valid?</span>(<span class="ruby-identifier">content</span> = <span class="ruby-keyword kw">nil</span>)
47:         <span class="ruby-comment cmt">#FIXME added here since trans is not P5 validable yet</span>
48:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
49:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000345" class="method-detail">
        <a name="M000345"></a>

        <div class="method-heading">
          <a href="#M000345" class="method-signature">
          <span class="method-name">leiden_trans</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000345-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000345-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 147</span>
147:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">leiden_trans</span>
148:     <span class="ruby-identifier">original_xml</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>
149:     <span class="ruby-identifier">original_xml_content</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">original_xml</span>)
150: 
151:     <span class="ruby-comment cmt"># if XML does not contain broke Leiden send XML to be converted to Leiden and return that</span>
152:     <span class="ruby-comment cmt"># otherwise, return nil (client can then get_broken_leiden)</span>
153:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">get_broken_leiden</span>(<span class="ruby-identifier">original_xml_content</span>).<span class="ruby-identifier">nil?</span>
154:       <span class="ruby-identifier">body</span> = <span class="ruby-constant">HGVTransIdentifier</span>.<span class="ruby-identifier">get_body</span>(<span class="ruby-identifier">original_xml</span>)
155:       
156:       <span class="ruby-comment cmt"># transform XML to Leiden+ </span>
157:       <span class="ruby-identifier">transformed</span> = <span class="ruby-constant">HGVTransIdentifier</span>.<span class="ruby-identifier">xml2nonxml</span>(<span class="ruby-identifier">body</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-comment cmt">#via jrubyHelper</span>
158:       
159:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">transformed</span>
160:     <span class="ruby-keyword kw">else</span>
161:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
162:     <span class="ruby-keyword kw">end</span>
163:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000347" class="method-detail">
        <a name="M000347"></a>

        <div class="method-heading">
          <a href="#M000347" class="method-signature">
          <span class="method-name">leiden_translation_to_xml</span><span class="method-args">(content)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000347-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000347-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 174</span>
174:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">leiden_translation_to_xml</span>(<span class="ruby-identifier">content</span>)
175:     
176:     <span class="ruby-comment cmt"># transform the Leiden Translation to XML</span>
177:     <span class="ruby-identifier">nonx2x</span> = <span class="ruby-constant">HGVTransIdentifier</span>.<span class="ruby-identifier">nonxml2xml</span>(<span class="ruby-identifier">content</span>)
178:         
179:     <span class="ruby-identifier">nonx2x</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/ xmlns:xml=&quot;http:\/\/www.w3.org\/XML\/1998\/namespace&quot;/</span>,<span class="ruby-value str">''</span>)
180:     <span class="ruby-identifier">transformed_xml_content</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">nonx2x</span>)
181:     
182:     <span class="ruby-comment cmt">#puts nonx2x</span>
183:     <span class="ruby-comment cmt">#puts transformed_xml_content.to_s</span>
184:     <span class="ruby-comment cmt"># fetch the original content</span>
185:     <span class="ruby-identifier">original_xml_content</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)
186:     
187:     <span class="ruby-comment cmt">#rip out the body so we can replace it with the new data</span>
188:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">delete_element</span>(<span class="ruby-value str">'/TEI/text/body'</span>)
189:     
190:     <span class="ruby-comment cmt">#add the new data</span>
191:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span>(<span class="ruby-value str">'/TEI/text'</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">text_element</span><span class="ruby-operator">|</span> <span class="ruby-identifier">text_element</span>.<span class="ruby-identifier">add_element</span>(<span class="ruby-identifier">transformed_xml_content</span>) }
192:     
193:  
194:     <span class="ruby-comment cmt"># write back to a string</span>
195:     <span class="ruby-identifier">modified_xml_content</span> = <span class="ruby-value str">''</span>
196:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">modified_xml_content</span>)
197:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">modified_xml_content</span>
198:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000334" class="method-detail">
        <a name="M000334"></a>

        <div class="method-heading">
          <a href="#M000334" class="method-signature">
          <span class="method-name">n_attribute</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000334-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000334-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 37</span>
37:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">n_attribute</span>
38:     <span class="ruby-identifier">ddb</span> = <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">find_by_publication_id</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)
39:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ddb</span>.<span class="ruby-identifier">n_attribute</span>
40:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000343" class="method-detail">
        <a name="M000343"></a>

        <div class="method-heading">
          <a href="#M000343" class="method-signature">
          <span class="method-name">preview</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000343-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000343-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 127</span>
127:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">preview</span>
128:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
129:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>),
130:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
131:         <span class="ruby-node">%w{data xslt pn start-divtrans-portlet.xsl}</span>)))
132:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000338" class="method-detail">
        <a name="M000338"></a>

        <div class="method-heading">
          <a href="#M000338" class="method-signature">
          <span class="method-name">related_text</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000338-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000338-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 59</span>
59:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">related_text</span>
60:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">i</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">DDBIdentifier</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">i</span>.<span class="ruby-identifier">is_reprinted?</span>}.<span class="ruby-identifier">last</span>
61:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000348" class="method-detail">
        <a name="M000348"></a>

        <div class="method-heading">
          <a href="#M000348" class="method-signature">
          <span class="method-name">save_broken_leiden_trans_to_xml</span><span class="method-args">(brokeleiden, commit_comment = '')</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000348-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000348-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 203</span>
203:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_broken_leiden_trans_to_xml</span>(<span class="ruby-identifier">brokeleiden</span>, <span class="ruby-identifier">commit_comment</span> = <span class="ruby-value str">''</span>)
204:     <span class="ruby-comment cmt"># fetch the original content</span>
205:     <span class="ruby-identifier">original_xml_content</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)
206:     <span class="ruby-comment cmt">#deletes XML with broke Leiden+ if it exists already so can add with updated data</span>
207:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">delete_element</span>(<span class="ruby-value str">'/TEI/text/body/div[@type = &quot;translation&quot;]/div[@subtype = &quot;brokeleiden&quot;]'</span>)
208:     <span class="ruby-comment cmt">#set in XML where to add new div tag to contain broken Leiden+ and add it</span>
209:     <span class="ruby-identifier">basepath</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;translation&quot;]'</span>
210:     <span class="ruby-identifier">add_node_here</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">original_xml_content</span>, <span class="ruby-identifier">basepath</span>)
211:     <span class="ruby-identifier">add_node_here</span>.<span class="ruby-identifier">add_element</span> <span class="ruby-value str">'div'</span>, {<span class="ruby-value str">'type'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">'translation'</span>, <span class="ruby-value str">'subtype'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">'brokeleiden'</span>}
212:     <span class="ruby-comment cmt">#set in XML where to add new note tag to contain broken Leiden+ and add it</span>
213:     <span class="ruby-identifier">basepath</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;translation&quot;]/div[@subtype = &quot;brokeleiden&quot;]'</span>
214:     <span class="ruby-identifier">add_node_here</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">original_xml_content</span>, <span class="ruby-identifier">basepath</span>)
215:     <span class="ruby-identifier">add_node_here</span>.<span class="ruby-identifier">add_element</span> <span class="ruby-value str">&quot;note&quot;</span>
216:     <span class="ruby-comment cmt">#set in XML where to add broken Leiden+ and add it</span>
217:     <span class="ruby-identifier">basepath</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;translation&quot;]/div[@subtype = &quot;brokeleiden&quot;]/note'</span>
218:     <span class="ruby-identifier">add_node_here</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">original_xml_content</span>, <span class="ruby-identifier">basepath</span>)
219:     <span class="ruby-identifier">brokeleiden</span> = <span class="ruby-constant">BROKE_LEIDEN_MESSAGE</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">brokeleiden</span>
220:     <span class="ruby-identifier">add_node_here</span>.<span class="ruby-identifier">add_text</span> <span class="ruby-identifier">brokeleiden</span>
221:     
222:     <span class="ruby-comment cmt"># write back to a string</span>
223:     <span class="ruby-identifier">modified_xml_content</span> = <span class="ruby-value str">''</span>
224:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">modified_xml_content</span>)
225:     
226:     <span class="ruby-comment cmt"># commit xml to repo</span>
227:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">modified_xml_content</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">commit_comment</span>)
228:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000346" class="method-detail">
        <a name="M000346"></a>

        <div class="method-heading">
          <a href="#M000346" class="method-signature">
          <span class="method-name">set_leiden_translation_content</span><span class="method-args">(leiden_translation_content, comment)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a String of the SHA1 of the commit
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000346-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000346-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 166</span>
166:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_leiden_translation_content</span>(<span class="ruby-identifier">leiden_translation_content</span>, <span class="ruby-identifier">comment</span>)
167:     <span class="ruby-comment cmt"># transform back to XML</span>
168:     <span class="ruby-identifier">xml_content</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">leiden_translation_to_xml</span>(<span class="ruby-identifier">leiden_translation_content</span>)
169:     <span class="ruby-comment cmt"># commit xml to repo</span>
170:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">xml_content</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>)
171:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000341" class="method-detail">
        <a name="M000341"></a>

        <div class="method-heading">
          <a href="#M000341" class="method-signature">
          <span class="method-name">stub_text_structure</span><span class="method-args">(lang)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000341-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000341-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 86</span>
 86:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stub_text_structure</span>(<span class="ruby-identifier">lang</span>)
 87:     <span class="ruby-identifier">translation_stub_xsl</span> =
 88:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
 89:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">related_text</span>.<span class="ruby-identifier">content</span>),
 90:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
 91:           <span class="ruby-node">%w{data xslt translation ddb_to_translation_xsl.xsl}</span>))
 92:       )
 93:     
 94:     <span class="ruby-identifier">rewritten_xml</span> =
 95:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
 96:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">content</span>),
 97:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-identifier">translation_stub_xsl</span>),
 98:         <span class="ruby-comment cmt">#:lang =&gt; 'en'</span>
 99:         <span class="ruby-comment cmt">#assumed that hard coded 'en' is remnant and should be</span>
100:         <span class="ruby-identifier">:lang</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lang</span>
101:       )
102:       
103:     
104:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">rewritten_xml</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;Update translation with stub for @xml:lang='#{lang}'&quot;</span>)
105:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000332" class="method-detail">
        <a name="M000332"></a>

        <div class="method-heading">
          <a href="#M000332" class="method-signature">
          <span class="method-name">to_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000332-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000332-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 15</span>
15:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_path</span>
16:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/#{self.class::TEMPORARY_COLLECTION}/</span>
17:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">temporary_path</span>
18:     <span class="ruby-keyword kw">else</span>
19:       <span class="ruby-identifier">path_components</span> = [ <span class="ruby-constant">PATH_PREFIX</span> ]
20:       <span class="ruby-comment cmt"># assume the name is e.g. hgv2302zzr</span>
21:       <span class="ruby-identifier">trimmed_name</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_components</span>.<span class="ruby-identifier">last</span> <span class="ruby-comment cmt"># 2302zzr</span>
22: 
23:       <span class="ruby-identifier">hgv_xml_path</span> = <span class="ruby-identifier">trimmed_name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'.xml'</span>
24: 
25:       <span class="ruby-comment cmt"># HGV_trans_EpiDoc uses a flat hierarchy</span>
26:       <span class="ruby-identifier">path_components</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">hgv_xml_path</span>
27: 
28:       <span class="ruby-comment cmt"># e.g. HGV_trans_EpiDoc/2302zzr.xml</span>
29:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path_components</span>)
30:     <span class="ruby-keyword kw">end</span>
31:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000340" class="method-detail">
        <a name="M000340"></a>

        <div class="method-heading">
          <a href="#M000340" class="method-signature">
          <span class="method-name">translation_already_in_language?</span><span class="method-args">(lang)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000340-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000340-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 71</span>
71:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">translation_already_in_language?</span>(<span class="ruby-identifier">lang</span>)
72:     <span class="ruby-identifier">lang_path</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;translation&quot; and @xml:lang = &quot;'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">lang</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'&quot;]'</span>
73:     
74:     <span class="ruby-identifier">doc</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)
75:     <span class="ruby-identifier">result</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">doc</span>, <span class="ruby-identifier">lang_path</span>)
76:     
77:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
78:      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
79:     <span class="ruby-keyword kw">else</span>
80:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
81:     <span class="ruby-keyword kw">end</span>
82:      
83:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000335" class="method-detail">
        <a name="M000335"></a>

        <div class="method-heading">
          <a href="#M000335" class="method-signature">
          <span class="method-name">xml_title_text</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000335-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000335-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/hgv_trans_identifier.rb, line 42</span>
42:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">xml_title_text</span>
43:     <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot; HGVTITLE (DDBTITLE) &quot;</span>
44:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>